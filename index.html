<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="description" content="Acceso oficial a la experiencia de casino online: tragamonedas, casino en vivo y mega bonos.">
    <meta property="og:title" content="Casino Oficial - Bono de Bienvenida">
    <meta property="og:description" content="Juegos en vivo, slots destacados y promociones exclusivas.">
    <meta property="og:image" content="bonus.png">
    <meta name="theme-color" content="#08112B">
    <meta name="facebook-domain-verification" content="jcwe76kq3gu42r8y1je5goyehiovvg">
    <title>Casino Oficial - Experiencia Online</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.85em' font-size='80'>🎰</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://connect.facebook.net" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">

    <!-- Meta Pixel Code -->
    <script>
        if (!window._fbPixelLoaded) {
            window._fbPixelLoaded = true;
            !function(f,b,e,v,n,t,s)
            {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
            n.callMethod.apply(n,arguments):n.queue.push(arguments)};
            if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
            n.queue=[];t=b.createElement(e);t.async=!0;
            t.src=v;s=b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t,s)}(window, document,'script',
            'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', '1126842699347074');
        }
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1126842699347074&ev=PageView&noscript=1"/></noscript>
    <!-- End Meta Pixel Code -->

    <style>
        :root {
            --bg: #050c20;
            --gradient: linear-gradient(135deg, #0a1a3b, #041024 70%);
            --primary: #3aa8ff;
            --accent: #ffbc00;
            --success: #29D366;
            --text: #ffffff;
            --muted: #9bb0d2;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            background: var(--gradient);
            color: var(--text);
            font-size: 16px;
            line-height: 1.5;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        img {
            display: block;
            max-width: 100%;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 40;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            background: linear-gradient(180deg, rgba(5,12,32,.95), rgba(5,12,32,.6) 85%, transparent);
        }

        .logo-mini {
            padding: 10px;
            border-radius: 20px;
            background: #0f1d3b;
            border: 1px solid #203454;
            box-shadow: 0 6px 20px -8px #020b19;
            margin-bottom: 12px;
        }

        .logo-mini img {
            height: 64px;
            width: auto;
        }

        .mascot {
            height: 200px;
            width: auto;
            margin-bottom: 8px;
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            will-change: auto;
        }

        .pill-badge {
            background: rgba(255,188,0,.12);
            color: var(--accent);
            padding: 10px 20px;
            border-radius: 40px;
            font-size: 14px;
            font-weight: 700;
            border: 1px solid rgba(255,188,0,.45);
            margin: 12px 0 0 0;
        }

        main {
            padding: 360px 16px 20px;
            width: 100%;
            max-width: 100vw;
            display: flex;
            justify-content: center;
        }

        .content {
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .hero {
            margin: 5px 0 10px 0;
            border-radius: 24px;
            padding: 24px 20px 28px;
            background: linear-gradient(145deg, #0d2142, #08132b 55%, #061027);
            box-shadow: 0 16px 60px -20px #031026;
        }

        .hero h1 {
            font-size: 30px;
            line-height: 1.15;
            font-weight: 800;
            margin: 0 0 18px;
        }

        .gradient-text {
            background: linear-gradient(90deg, #3aa8ff, #69d4ff 45%, #ffbc00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .hero p {
            font-size: 18px;
            color: var(--muted);
            font-weight: 500;
            margin: 0 0 32px;
        }

        /* Animaciones para el botón */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.03);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 15px 40px -12px #1fbf5999, 0 0 0 2px #1a5d37 inset, 0 0 20px rgba(37, 211, 102, 0.3);
            }
            50% {
                box-shadow: 0 15px 40px -12px #1fbf5999, 0 0 0 2px #1a5d37 inset, 0 0 35px rgba(37, 211, 102, 0.6);
            }
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366, #1fbf59, #0f9942);
            width: 95%;
            max-width: 450px;
            border: none;
            color: #fff;
            font-weight: 800;
            font-size: 26px;
            padding: 32px 40px;
            border-radius: 35px;
            box-shadow: 0 15px 40px -12px #1fbf5999, 0 0 0 2px #1a5d37 inset;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 18px;
            cursor: pointer;
            height: 95px;
            margin: 0 auto;
            transition: all 0.3s ease;
            animation: pulse 2.5s ease-in-out infinite, glow 2.5s ease-in-out infinite;
        }

        .btn-whatsapp:hover {
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 20px 50px -10px #1fbf59cc, 0 0 0 2px #1a5d37 inset, 0 0 40px rgba(37, 211, 102, 0.8);
            animation: none;
        }

        .btn-whatsapp:active {
            transform: scale(0.98);
            box-shadow: 0 10px 30px -12px #1fbf5999, 0 0 0 2px #1a5d37 inset;
        }

        .btn-whatsapp img {
            height: 50px;
            width: 50px;
            animation: float 3s ease-in-out infinite;
        }

        .btn-whatsapp:hover img {
            animation: none;
            transform: rotate(15deg) scale(1.1);
            transition: transform 0.3s ease;
        }

        .juegos-img {
            width: 100%;
            max-width: 420px;
            height: auto;
            margin: 20px auto 0;
            border-radius: 16px;
            box-shadow: 0 8px 25px -8px rgba(0,0,0,0.4);
        }

        .mini-note {
            margin-top: 16px;
            font-size: 15px;
            color: #5d7196;
        }

        footer {
            margin: 30px 0 0;
            padding: 20px 8px 60px;
            text-align: center;
            font-size: 9px;
            color: #5d7196;
        }

        @media (max-width: 768px) {
            header {
                padding: 10px 0;
            }
            .logo-mini {
                padding: 8px;
                margin-bottom: 8px;
            }
            .logo-mini img {
                height: 48px;
            }
            .mascot {
                height: 150px;
                transform: translateZ(0);
                backface-visibility: hidden;
                margin-bottom: 6px;
            }
            .pill-badge {
                padding: 8px 16px;
                font-size: 13px;
                margin: 8px 0 0 0;
            }
            main {
                padding: 280px 12px 15px;
            }
            .hero {
                padding: 16px 14px 20px;
                margin: 0;
            }
            .hero h1 {
                font-size: 20px;
                margin: 0 0 12px;
                line-height: 1.2;
            }
            .hero p {
                font-size: 13px;
                margin: 0 0 18px;
            }
            .btn-whatsapp {
                height: 75px;
                font-size: 18px;
                padding: 20px 24px;
            }
            .btn-whatsapp img {
                height: 36px;
                width: 36px;
            }
            .juegos-img {
                max-width: 100%;
                margin: 12px auto 0;
                border-radius: 12px;
            }
            .mini-note {
                margin-top: 10px;
                font-size: 13px;
            }
            footer {
                margin: 15px 0 0;
                padding: 12px 8px 40px;
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-mini">
            <img src="logo.png" alt="Logo" loading="eager">
        </div>
        <img src="mascota.png" alt="Mascota" class="mascot" loading="eager">
        <div class="pill-badge">ACCESO VIP</div>
    </header>

    <main>
        <div class="content">
            <section class="hero">
                <h1>OBTENÉ UN <span class="gradient-text">30%</span> EN TU PRIMER DEPÓSITO</h1>
                <p><span style="color:#ffbc00;font-weight:700;">Escribinos apretando el botón de abajo</span></p>

                <button id="whatsapp-btn" class="btn-whatsapp">
                    <img src="logo_whatsapp.png" alt="WhatsApp" loading="eager">
                    <span>WHATSAPP OFFICIAL</span>
                </button>

                <div class="mini-note" style="color:#ffbc00;font-weight:700;">ATENCIÓN Y RETIROS LAS 24 HS</div>

                <img src="juegos.png" alt="Juegos" class="juegos-img" loading="eager">
            </section>

            <footer>
                © 2025 el juego es solo +18. Operá con responsabilidad.
            </footer>
        </div>
    </main>

<script>
// ============================================
// PROTECCIÓN TRIPLE CONTRA EJECUCIÓN MÚLTIPLE
// ============================================
if (window.__TRACKING_INITIALIZED__) {
    console.warn('⛔ Sistema YA inicializado - abortando');
} else {
    window.__TRACKING_INITIALIZED__ = true;
    Object.freeze(window.__TRACKING_INITIALIZED__);

(function() {
    'use strict';

    const CONFIG = {
        whatsapp: '5491171071767',
        backend: 'https://beige-toes-wonder.loca.lt',
        message: 'Hola, quiero mi usuario! mi codigo promocional es: '
    };

    // UUID Generator
    function generateUUID() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            const r = Math.random() * 16 | 0;
            const v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    // Capturar parámetros UTM y fbclid de la URL
    function captureUTMParams() {
        const params = new URLSearchParams(window.location.search);
        return {
            utm_source: params.get('utm_source') || null,
            utm_medium: params.get('utm_medium') || null,
            utm_campaign: params.get('utm_campaign') || null,
            utm_content: params.get('utm_content') || null,
            utm_term: params.get('utm_term') || null,
            fbclid: params.get('fbclid') || null,
            gclid: params.get('gclid') || null // Google Ads también
        };
    }

    // ESTADO GLOBAL - UNA SOLA VEZ
    const STATE = {
        eventId: null,
        pageviewSent: false,
        clickSent: false,
        clicking: false,
        initialized: false,
        attribution: captureUTMParams() // Capturar al inicio
    };

    // Generar event_id GLOBAL
    function getEventId() {
        if (!STATE.eventId) {
            STATE.eventId = generateUUID();
            console.log('🆔 Event ID:', STATE.eventId);
        }
        return STATE.eventId;
    }

    // Track - con protección MEJORADA (sendBeacon para confiabilidad)
    async function track(type) {
        const key = type === 'pageview' ? 'pageviewSent' : 'clickSent';

        console.log(`🔍 Intentando enviar: ${type}, Estado actual: ${STATE[key]}`);

        if (STATE[key]) {
            console.warn(`⚠️ ${type} ya enviado - bloqueado`);
            return;
        }

        STATE[key] = true;

        console.log(`🔄 Enviando ${type} al backend...`);

        const payload = {
            event_id: getEventId(),
            event_type: type,
            timestamp: new Date().toISOString(),
            user_agent: navigator.userAgent,
            referrer: document.referrer || 'direct',
            attribution: STATE.attribution
        };

        // Usar fetch con headers personalizados (requerido para LocalTunnel)
        try {
            const response = await fetch(`${CONFIG.backend}/api/track`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'bypass-tunnel-reminder': 'true'
                },
                body: JSON.stringify(payload)
            });
            console.log(`✅ ${type} registrado con fetch - Response:`, response.status);

            if (STATE.attribution.fbclid || STATE.attribution.utm_campaign) {
                console.log('📊 Attribution:', STATE.attribution);
            }
        } catch (e) {
            console.error('❌ Error backend:', e);
        }
    }

    // Facebook Pixel
    function fbEvent(name) {
        if (typeof fbq !== 'undefined') {
            fbq('track', name, {}, { eventID: getEventId() });
            console.log(`✅ FB: ${name}`);
        }
    }

    // Inicializar UNA SOLA VEZ
    function init() {
        if (STATE.initialized) {
            console.warn('⛔ Ya inicializado');
            return;
        }
        STATE.initialized = true;

        const id = getEventId();
        track('pageview');
        fbEvent('PageView');
        console.log('📊 Tracking iniciado');

        // Configurar botón
        const btn = document.getElementById('whatsapp-btn');
        if (btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                if (STATE.clicking) {
                    console.log('⏳ Cooldown activo');
                    return;
                }

                STATE.clicking = true;
                console.log('🖱️ Click detectado');

                const id = getEventId();
                const msg = CONFIG.message + id;
                const url = `https://api.whatsapp.com/send?phone=${CONFIG.whatsapp}&text=${encodeURIComponent(msg)}`;

                console.log('➡️ Preparando WhatsApp:', url);
                console.log('📱 Número:', CONFIG.whatsapp);
                console.log('💬 Mensaje:', msg);
                console.log('🆔 Event ID:', id);

                // PRIMERO: Enviar tracking ANTES de abrir WhatsApp (garantiza registro)
                track('whatsapp_click');
                fbEvent('ClickWhatsApp');
                console.log('📊 Tracking enviado ANTES de abrir WhatsApp');

                // DESPUÉS: Abrir WhatsApp
                const newWin = window.open(url, '_blank');

                if (newWin) {
                    console.log('✅ Ventana abierta correctamente');
                } else {
                    console.error('❌ Ventana bloqueada por el navegador');
                }

                setTimeout(() => { STATE.clicking = false; }, 2000);
            }, { once: false, passive: false });
        }

        console.log('✅ Sistema listo - esperando click del usuario');
    }

    // Ejecutar solo cuando DOM esté listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init, { once: true });
    } else {
        init();
    }
})();

}
</script>
</body>
</html>
